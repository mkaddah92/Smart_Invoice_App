/**
 * Implementation for Rmart_Invoice_AppService defined in ./service.cds
 * @After(event = { "READ" }, entity = "Smart_Invoice_AppService.Headers")
 * @param {(Object|Object[])} results - For the After phase only: the results of the event processing
 * @param {Object} request - User information, tenant-specific CDS model, headers and query parameters
*/
module.exports = async function(results, request) {
	// Your code here
	console.log("on read");
	console.log(results);
	
	results.forEach(header => {
		if(header.dox_status == "PENDING"){
			//console.log("call api to update");
			//call DoX api to fetch job details:
			var request = require('request');
			var options = {
			'method': 'GET',
			'url': 'https://aiservices-dox.cfapps.eu10.hana.ondemand.com/document-information-extraction/v1/document/jobs/142bb42c-cc48-486d-bf59-f9b637406eb9',
			'headers': {
				'Authorization': 'Bearer eyJhbGciOiJSUzI1NiIsImprdSI6Imh0dHBzOi8vZW1lYS1zb3V0aC1zYXBidWlsZC1jbXRlOTFjcC5hdXRoZW50aWNhdGlvbi5ldTEwLmhhbmEub25kZW1hbmQuY29tL3Rva2VuX2tleXMiLCJraWQiOiJkZWZhdWx0LWp3dC1rZXktMTEyMjgwNzczMSIsInR5cCI6IkpXVCIsImppZCI6ICJ6d284V01SZFdiYVNVQ1lEekJNd0pBK01pZG9WWEp5MHpzanBqdHZnQnRVPSJ9.eyJqdGkiOiI1N2I5YmViZGNkNTY0NTRiYTFkYmFiOGZhY2Y5ODA4NSIsImV4dF9hdHRyIjp7ImVuaGFuY2VyIjoiWFNVQUEiLCJzdWJhY2NvdW50aWQiOiI5ZDBhNDFjZS1mMzM5LTRiN2YtYmM0OC1mZDQwYjczYzdhNmYiLCJ6ZG4iOiJlbWVhLXNvdXRoLXNhcGJ1aWxkLWNtdGU5MWNwIiwic2VydmljZWluc3RhbmNlaWQiOiI0OTc1YTQ2Ny04MGY0LTQzMWQtYWVkMy0xMjc5ZDE2OTI0MDAifSwic3ViIjoic2ItNDk3NWE0NjctODBmNC00MzFkLWFlZDMtMTI3OWQxNjkyNDAwIWIxNjkwNjB8bmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMSIsImF1dGhvcml0aWVzIjpbIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEuaWRlbnRpZmllci5yZWFkIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5zY2hlbWEud3JpdGUiLCJ1YWEucmVzb3VyY2UiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLmRhdGEud3JpdGUiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLmNhcGFiaWxpdGllcy5yZWFkIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5jb25maWcud3JpdGUiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLmNsaWVudC5yZWFkIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5jb25maWcucmVhZCIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEuZG9jdW1lbnQud3JpdGUiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLnRlY2huaWNhbHNjb3BlIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5jbGllbnQud3JpdGUiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLnRlbXBsYXRlLnJlYWQiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLmRvY3VtZW50LnJlYWQiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLmlkZW50aWZpZXIud3JpdGUiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLnRyYWluaW5nLWRhdGEucmVhZCIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEudGVtcGxhdGUud3JpdGUiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLmRhdGEtZXhwb3J0LndyaXRlIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5kYXRhLnJlYWQiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLnJ1bGVzLndyaXRlIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5kYXRhLWV4cG9ydC5yZWFkIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5zY2hlbWEucmVhZCIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEudHJhaW5pbmctZGF0YS53cml0ZSJdLCJzY29wZSI6WyJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLmlkZW50aWZpZXIucmVhZCIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEuc2NoZW1hLndyaXRlIiwidWFhLnJlc291cmNlIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5kYXRhLndyaXRlIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5jYXBhYmlsaXRpZXMucmVhZCIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEuY29uZmlnLndyaXRlIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5jbGllbnQucmVhZCIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEuY29uZmlnLnJlYWQiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLmRvY3VtZW50LndyaXRlIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS50ZWNobmljYWxzY29wZSIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEuY2xpZW50LndyaXRlIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS50ZW1wbGF0ZS5yZWFkIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5kb2N1bWVudC5yZWFkIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5pZGVudGlmaWVyLndyaXRlIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS50cmFpbmluZy1kYXRhLnJlYWQiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLnRlbXBsYXRlLndyaXRlIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5kYXRhLWV4cG9ydC53cml0ZSIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEuZGF0YS5yZWFkIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5ydWxlcy53cml0ZSIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEuZGF0YS1leHBvcnQucmVhZCIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEuc2NoZW1hLnJlYWQiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLnRyYWluaW5nLWRhdGEud3JpdGUiXSwiY2xpZW50X2lkIjoic2ItNDk3NWE0NjctODBmNC00MzFkLWFlZDMtMTI3OWQxNjkyNDAwIWIxNjkwNjB8bmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMSIsImNpZCI6InNiLTQ5NzVhNDY3LTgwZjQtNDMxZC1hZWQzLTEyNzlkMTY5MjQwMCFiMTY5MDYwfG5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEiLCJhenAiOiJzYi00OTc1YTQ2Ny04MGY0LTQzMWQtYWVkMy0xMjc5ZDE2OTI0MDAhYjE2OTA2MHxuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxIiwiZ3JhbnRfdHlwZSI6ImNsaWVudF9jcmVkZW50aWFscyIsInJldl9zaWciOiJjMjhhNDc4YSIsImlhdCI6MTcxMDkyOTYxOCwiZXhwIjoxNzEwOTcyODE4LCJpc3MiOiJodHRwczovL2VtZWEtc291dGgtc2FwYnVpbGQtY210ZTkxY3AuYXV0aGVudGljYXRpb24uZXUxMC5oYW5hLm9uZGVtYW5kLmNvbS9vYXV0aC90b2tlbiIsInppZCI6IjlkMGE0MWNlLWYzMzktNGI3Zi1iYzQ4LWZkNDBiNzNjN2E2ZiIsImF1ZCI6WyJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLmNhcGFiaWxpdGllcyIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEuY2xpZW50Iiwic2ItNDk3NWE0NjctODBmNC00MzFkLWFlZDMtMTI3OWQxNjkyNDAwIWIxNjkwNjB8bmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMSIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEuZGF0YSIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEucnVsZXMiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLnNjaGVtYSIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEuY29uZmlnIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5pZGVudGlmaWVyIiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS5kYXRhLWV4cG9ydCIsInVhYSIsIm5hLWYyMDU0OGMwLTE1N2QtNDE3Yi04YmJiLTFjOWYzNWVjZmIyZCFiMjA4MjEiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLnRyYWluaW5nLWRhdGEiLCJuYS1mMjA1NDhjMC0xNTdkLTQxN2ItOGJiYi0xYzlmMzVlY2ZiMmQhYjIwODIxLmRvY3VtZW50IiwibmEtZjIwNTQ4YzAtMTU3ZC00MTdiLThiYmItMWM5ZjM1ZWNmYjJkIWIyMDgyMS50ZW1wbGF0ZSJdfQ.WjPMCsBfUQtL3bQCUbxjJ8Ghq044tByv5G_4IaP5BejTPG4hwxmeZEL8HNDZDjMrY28MbQBqE5cP2Pa4d2VsssyMklQ9w-PgfrAuCtJgC7C7_mv0LO42MrVuSXAhWF3qWAZW9F3kAH4EJ10KzEMTVxqNW2GCidZjaVjaNu4j8bcbMqsRhRYOoOU7S2xR4m728aResA8-4IZDDlPIsXZfSS712-sRiTc6uWNqtMtW-lthnQSTciS1kTHy6PoAccmR27da9rCb0clxUfzR6ntsV-KoOl73ie12wfrDYbDdNfoZNUotB6Wv4PgFXBrAECQKsGOHlVbyzJI5TN89f00YfQ'
				}
			};
			
			request(options, function (error, response) {
			if (error) throw new Error(error);
				//console.log(response.body);
				//update header and items entities here
			});
			

			




			
		}
	});
	
	/*
	const headers = Array.isArray(headersData) ? headersData : [headersData];
	headers.forEach(header => {
		
	});
	*/
}